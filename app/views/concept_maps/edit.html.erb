<%= render 'concept_maps/editor/navigation_elements' %>

<!-- Intro -->
<% if @concept_map.first? %>
  <%= render 'concept_maps/editor/intro' %>
<% end %>

<!-- Flexible form for CRUD-actions -->
<div id="panel" class="hidden panel panel-default" style="z-index:1; position:absolute; left:0px; top:0px;">
  <div class="panel-body">
    <p><em id="action"></em><button type="button" class="close pull-right" onclick="hideForm();" aria-label="Close"><span class="glyphicon glyphicon-remove" aria-hidden="true" style="font-size: 12pt"></span></button></p>

    <form id="form" class="form-inline" onsubmit="submitChanges(event);return false;">
      <div class="form-group">
        <% if @concept_map.survey.association_labels.blank? %>
            <input id="entry_link" class="form-control" name="link[label]" placeholder="<%= t :name %>" type="text" />
        <% else %>
            <%= select_tag 'link[label]', options_for_select(@concept_map.survey.association_labels.split(',').map{|l| l.strip}), id: 'entry_link', class: 'form-control' %>
        <% end %>
        <input id="entry_concept" class="form-control" name="concept[label]" placeholder="<%= t :name %>" type="text" />
        <input id="x" type="hidden" name="concept[x]"/>
        <input id="y" type="hidden" name="concept[y]"/>
        <input id="start" type="hidden" name="link[start]"/>
        <input id="end" type="hidden" name="link[end]"/>
      </div>
      <div class="form-group">
        <%= render 'concept_maps/editor/colorpicker' %>
        <%= render 'concept_maps/editor/shapepicker' %>
        <%= render 'concept_maps/editor/edgepicker' %>
        <button class="btn btn-sm btn-success glyphicon glyphicon-ok" onclick="validateForm();"></button>
        <button id="delete" class="btn btn-sm btn-danger glyphicon glyphicon-trash" onclick="destroy();return false;"></button>
      </div>
    </form>
  </div>
</div>
<!-- Cursor Function Button -->
<div id="header-cursor">
  <button id="cursor-button" class="btn info"><span>Edit</span></button>
</div>

<!-- Node Function Button -->
<div id="header-node">
  <button id="node-button" class="btn info"><span>Add Node</span></button>
</div>

<!-- Edge Function Button -->
<div id="header-edge">
  <button id="edge-button" class="btn info"><span>Add Edge</span></button>
</div>

<!-- Misc Function Button -->
<div id="header-misc">
  <button id="misc-button" class="hidden btn info" >Misc</button>
</div>



<!-- Dummy element for Vis-canvas -->
<div id="map-canvas">
</div>

<!-- Scripts -->
<script type="module">
  import { init } from "application"

  init({
    edgeData: [
        <% @concept_map.links.each do |l| %>
        <%= render l %>,
        <% end %>
    ],
    nodeData: [
        <% @concept_map.concepts.each do |c| %>
        <%= render c %>,
        <% end %>
    ],
    conceptsPath: "<%= concept_map_concepts_path(@map) %>",
    linksPath: "<%= concept_map_links_path(@map) %>",
    dialogTexts: {
      editNode: "<%= t('.action_edit_node')%>",
      addNode: "<%= t('.action_new_node')%>",
      editEdge: "<%= t('.action_edit_link')%>",
      addEdge: "<%= t('.action_new_link')%>"
    }
  }
  )
</script>
